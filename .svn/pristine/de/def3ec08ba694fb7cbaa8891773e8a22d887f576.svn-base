<?php

include 'database.php';
include 'templates.php';
 
$Datei=file("dates.txt");
$WDays = array("So", "Mo", "Di", "Mi", "Do", "Fr", "Sa" );
$Months = array( "Jan", "Feb", "M&auml;r", "Apr", "Mai", "Jun", "Jul", "Aug", "Sep", "Okt", "Nov", "Dez" );

$Now = time();

$Output = '';

if( DBOpen( $Link ) ) {
	$result = mysql_query( "SELECT * FROM ".TAB_DATES." WHERE timestamp > ".$Now." ORDER BY timestamp ASC" );
	if( !$result ) {
		// No dates found
		$Output = GetTemplate( 'templates/dates_list_empty.htm' );
	}// if
	else {
		if( mysql_num_rows($result) != 0 ) {
			while( $RowTime = mysql_fetch_array( $result ) ) {
				if( $RowTime['timestamp'] >= $Now ) {
					$result2 = mysql_query( "SELECT * FROM ".TAB_LOCATIONS." WHERE ID=".$RowTime['location'] );
					$RowLocation = mysql_fetch_array( $result2 );

					$Ausgabe = strtok( ";" );
					$GoogleLink = str_replace( ' ', '+', $RowLocation['address'] );

					// display date
					$Content = array(
						 'WEEKDAY' => $WDays[ strftime('%w', $RowTime['timestamp'] ) ]
						,'DAY' => strftime("%d", $RowTime['timestamp'] )
						,'MONTH' => $Months[ strftime("%m", $RowTime['timestamp'] ) - 1 ]
						,'YEAR' => strftime("%Y", $RowTime['timestamp'] )
						,'TIME' => strftime("%H:%M", $RowTime['timestamp'] )
						,'LOCATION' => $RowLocation['name']
						,'ADDRESS' => $RowLocation['address']
						,'GOOGLELINK' => $GoogleLink
					);
					$Output .= ParseTemplate( 'templates/dates_list.htm', $Content );
				}// if
			}// while
		}// if
		else {
			// No dates found
			$Output = ParseTemplate( 'templates/dates_list_empty.htm', array('' => '') );
		}// else
	}// else
	DBClose( $Link );
}// if
else {
}// else

$Content = array( 'DATELIST' => $Output );
$Output = ParseTemplate( 'templates/dates.htm', $Content );

$Content = array( 'CONTENT' => $Output );
$Output = ParseTemplate( 'templates/site.htm', $Content );

echo $Output;


?>




